var os=Object.defineProperty,ls=Object.defineProperties;var ns=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var is=Object.prototype.hasOwnProperty,rs=Object.prototype.propertyIsEnumerable;var O=(l,o,c)=>o in l?os(l,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[o]=c,L=(l,o)=>{for(var c in o||(o={}))is.call(o,c)&&O(l,c,o[c]);if(j)for(var c of j(o))rs.call(o,c)&&O(l,c,o[c]);return l},E=(l,o)=>ls(l,ns(o));import{Q as V}from"./QSeparator.f2252361.js";import{Q as H}from"./QTab.f5192df6.js";import{c as cs}from"./QTabs.c7351fdd.js";import{c as us,a as S,h as B,T as ds,g as _s,$ as ms,a3 as ss,H as n,a6 as w,K as m,J as a,ax as es,F as z,q as F,r as A,D as ps,ay as fs,az as hs,aA as ts,G as vs,I as h,N as s,L as _,O as D,a7 as y,Q,M as b,a4 as gs,aB as T,aC as $,R as q,aD as ys,aE as R,aF as J,P as K,A as ws,aG as M,aH as W,aI as xs}from"./index.ef0b161e.js";import{u as ks,a as bs,n as x}from"./notifyApiError.22ce61ab.js";import{a as Cs,c as Ps,o as X,q as Y,C as Is,s as Qs,n as as,t as qs}from"./PostEditorDialog.161797bd.js";import{Q as $s}from"./QPage.364c4deb.js";import{Q as Bs,a as Z}from"./QCardSection.b4764d2d.js";import{Q as U,_ as Ss}from"./PostDialog.1ff7ebff.js";import{Q as Fs}from"./notifyApiSuccess.91591755.js";var As=us({name:"QInnerLoading",props:E(L(L({},ks),Cs),{showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]}),setup(l,{slots:o}){const c=_s(),u=bs(l,c.proxy.$q),{transition:v,transitionStyle:p}=Ps(l,S(()=>l.showing)),d=S(()=>"q-inner-loading absolute-full column flex-center"+(u.value===!0?" q-inner-loading--dark":"")),C=S(()=>"q-inner-loading__label"+(l.labelClass!==void 0?` ${l.labelClass}`:""));function t(){const I=[B(ms,{size:l.size,color:l.color})];return l.label!==void 0&&I.push(B("div",{class:C.value,style:l.labelStyle},[l.label])),I}function P(){return l.showing===!0?B("div",{class:d.value,style:p.value},o.default!==void 0?o.default():t()):null}return()=>B(ds,{name:v.value,appear:!0},P)}});const Ds={};function Ls(l,o){return n(),w(Fs,null,{default:m(()=>[a(X,{avatar:""},{default:m(()=>[a(U,{type:"QAvatar",animation:"fade"})]),_:1}),a(X,null,{default:m(()=>[a(Y,null,{default:m(()=>[a(U,{type:"text",animation:"fade"})]),_:1}),a(Y,{caption:""},{default:m(()=>[a(U,{type:"text",animation:"fade"})]),_:1})]),_:1})]),_:1})}var Us=ss(Ds,[["render",Ls]]);const Vs={class:"row q-px-md q-mb-xl"},Ts={class:"col-4 text-center q-mr-lg"},zs=["src"],Ns={class:"col"},Gs={class:"row wrap"},js={class:"text-h4 q-mt-none q-mr-md q-mb-sm ellipsis"},Os={class:"gt-xs list-unstyled row"},Es={class:"col-auto q-mr-xl text-subtitle1"},Hs={class:"text-bold"},Rs=q(" \u8CBC\u6587 "),Js={class:"col-auto q-mr-xl text-subtitle1"},Ks={class:"text-bold"},Ms=q(" \u4F4D\u7C89\u7D72 "),Ws={class:"col-auto text-subtitle1"},Xs={class:"text-bold"},Ys=q(" \u8FFD\u8E64\u4E2D "),Zs={class:"lt-sm"},se={class:"list-unstyled row text-center"},ee={class:"col text-subtitle2"},te={class:"text-bold"},ae=s("span",{class:"block text-grey"}," \u8CBC\u6587 ",-1),oe={class:"col text-subtitle2"},le={class:"cursor-pointer"},ne={class:"text-bold"},ie=s("span",{class:"block text-grey"}," \u4F4D\u7C89\u7D72 ",-1),re={class:"col text-subtitle2"},ce={class:"cursor-pointer"},ue={class:"text-bold"},de=s("span",{class:"block text-grey"}," \u8FFD\u8E64\u4E2D ",-1),_e={class:"col text-h6 text-center self-center"},me={key:0,class:"list-unstyled"},pe={key:1,class:"list-unstyled q-ma-none",style:{"min-height":"200px"}},fe={key:0,class:"text-center"},he={class:"col"},ve={class:"row"},ge={class:"q-pr-md"},ye=["src"],we={class:"self-center text-bold"},xe={class:"col-auto self-center"},ke={__name:"ProfileSection",setup(l){const o=es(),c=z(),u=F("defaultAvatar"),v=F("tenThousandths"),p=F("isLoginUserPage"),d=A({}),C=async()=>{try{const e=await ys(o.params.userId);d.value=e.data}catch(e){x(e)}finally{}},t=ps({loading:!1,loadingBtn:"",handler:!1,title:"",users:[],open:async e=>{t.loading=!0,t.users=[],t.title=e,t.handler=!0;try{const i=e==="\u7C89\u7D72"?await fs(o.params.userId):await hs(o.params.userId);t.users=i.data}catch(i){x(i),t.handler=!1}finally{t.loading=!1}}});C(),ts(async(e,i)=>{C()});const P=async e=>{t.loadingBtn=e.user._id;try{await R(e.user._id),e.isFollowed=!0,e.fansCount++}catch(i){x(i)}finally{t.loadingBtn=""}},I=async e=>{t.loadingBtn=e.user._id;try{await J(e.user._id),e.isFollowed=!1,e.fansCount--}catch(i){x(i)}finally{t.loadingBtn=""}},f=async e=>{t.loadingBtn=e.user._id;try{await R(e.user._id),e.isFollowed=!0,p.value&&d.value.followingsCount++}catch(i){x(i)}finally{t.loadingBtn=""}},g=async e=>{t.loadingBtn=e.user._id;try{await J(e.user._id),e.isFollowed=!1,p.value&&d.value.followingsCount--}catch(i){x(i)}finally{t.loadingBtn=""}};return(e,i)=>{var G;const N=vs("router-link");return n(),h(b,null,[s("section",null,[s("div",Vs,[s("div",Ts,[a(D,{class:"fit",style:{"max-width":"150px"}},{default:m(()=>{var r,k;return[s("img",{src:(k=(r=d.value.user)==null?void 0:r.avatar)!=null?k:_(u)},null,8,zs)]}),_:1})]),s("div",Ns,[s("div",Gs,[s("h2",js,y((G=d.value.user)==null?void 0:G.screenName),1),s("div",null,[_(p)?(n(),w(Q,{key:0,label:"\u7DE8\u8F2F\u500B\u4EBA\u6A94\u6848",outline:"",class:"text-bold q-mr-sm",to:{name:"AccountPage"}})):(n(),h(b,{key:1},[d.value.isFollowed?(n(),w(Q,{key:1,icon:"eva-person-done",onClick:i[1]||(i[1]=r=>I(d.value)),outline:"",color:"primary"})):(n(),w(Q,{key:0,label:"\u8FFD\u8E64",onClick:i[0]||(i[0]=r=>P(d.value)),color:"primary"}))],64))])]),s("ul",Os,[s("li",Es,[s("span",Hs,y(_(v)(d.value.postsCount)),1),Rs]),s("li",Js,[s("a",{onClick:i[2]||(i[2]=r=>t.open("\u7C89\u7D72")),class:"cursor-pointer"},[s("span",Ks,y(_(v)(d.value.fansCount)),1),Ms])]),s("li",Ws,[s("a",{onClick:i[3]||(i[3]=r=>t.open("\u8FFD\u8E64\u4E2D")),class:"cursor-pointer"},[s("span",Xs,y(_(v)(d.value.followingsCount)),1),Ys])])])])]),s("div",Zs,[a(V),s("ul",se,[s("li",ee,[s("span",te,y(_(v)(d.value.postsCount)),1),ae]),s("li",oe,[s("a",le,[s("span",ne,y(_(v)(d.value.fansCount)),1),ie])]),s("li",re,[s("a",ce,[s("span",ue,y(_(v)(d.value.followingsCount)),1),de])])])])]),a(Qs,{modelValue:t.handler,"onUpdate:modelValue":i[4]||(i[4]=r=>t.handler=r)},{default:m(()=>[a(Bs,{style:{width:"100vw","max-width":"400px"}},{default:m(()=>[a(Z,{class:"row q-pa-sm"},{default:m(()=>[s("div",_e,y(t.title),1),gs(a(Q,{icon:"close",flat:"",round:"",dense:"",class:"col-auto"},null,512),[[Is]])]),_:1}),a(V),a(Z,{style:{"max-height":"50vh"},class:"scroll"},{default:m(()=>[t.loading?(n(),h("ul",me,[(n(),h(b,null,T(3,r=>s("li",{key:r},[a(Us)])),64))])):(n(),h("ul",pe,[t.users.length==0?(n(),h("li",fe,y(`\u76EE\u524D\u7121${t.title}\u3002`),1)):$("",!0),(n(!0),h(b,null,T(t.users,r=>(n(),h("li",{key:r.user._id,class:"row justify-between q-mb-sm"},[s("div",he,[s("div",ve,[s("div",ge,[a(N,{to:{name:"PersonalPage",params:{userId:r.user._id}}},{default:m(()=>[a(D,{size:"lg"},{default:m(()=>{var k;return[s("img",{src:(k=r.user.avatar)!=null?k:_(u)},null,8,ye)]}),_:2},1024)]),_:2},1032,["to"])]),s("div",we,[a(N,{to:{name:"PersonalPage",params:{userId:r.user._id}},class:"link-text"},{default:m(()=>[q(y(r.user.screenName),1)]),_:2},1032,["to"])])])]),s("div",xe,[r.isFollowed?(n(),w(Q,{key:0,label:"\u8FFD\u8E64\u4E2D",onClick:k=>g(r),loading:t.loadingBtn===r.user._id,outline:"",color:"primary"},null,8,["onClick","loading"])):r.user._id!==_(c).user._id?(n(),w(Q,{key:1,label:"\u8FFD\u8E64",onClick:k=>f(r),loading:t.loadingBtn===r.user._id,color:"primary"},null,8,["onClick","loading"])):$("",!0)])]))),128))]))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};const be={class:"mask absolute-full text-subtitle2 flex flex-center"},Ce={class:"mask__content list-unstyled flex flex-center wrap"},Pe={class:"q-mr-md"},Ie={__name:"PostBrick",props:{post:{type:Object,required:!0}},emits:["showPost"],setup(l,{emit:o}){const c=l;z(),as();const u=F("tenThousandths");return(v,p)=>(n(),w(qs,{onClick:p[0]||(p[0]=d=>o("showPost",c.post)),src:c.post.image,ratio:"1"},{default:m(()=>[s("div",be,[s("ul",Ce,[s("li",Pe,[a(K,{size:"sm",name:"eva-heart"}),q(" "+y(_(u)(c.post.likes.length)),1)]),s("li",null,[a(K,{size:"sm",name:"eva-message-circle"}),q(" "+y(_(u)(c.post.comments.length)),1)])])])]),_:1},8,["src"]))}};var Qe=ss(Ie,[["__scopeId","data-v-31c88a34"]]);const qe={class:"constrain justify-center q-py-lg"},$e={class:"relative-position"},Be={class:"list-unstyled row q-col-gutter-md"},Se={key:0,class:"q-pa-lg text-center text-body1"},Fe={key:0},Ae={key:1},De=s("p",null,"\u53EF\u4EE5\u67E5\u770B\u4F60\u8B9A\u904E\u7684\u8CBC\u6587\u3002\u53EA\u6709\u4F60\u53EF\u4EE5\u67E5\u770B\u4F60\u6309\u904E\u8B9A\u7684\u8CBC\u6587\u7684\u5167\u5BB9\u3002",-1),Re={__name:"PersonalPage",setup(l){const o=es(),c=z(),u=as(),v=S(()=>c.user._id===o.params.userId);ws("isLoginUserPage",v);const p=A("posts"),d=async()=>{u.loadingPosts=!0;try{const f=p.value==="posts"?await M({user:o.params.userId}):await W();u.posts=f.data}catch(f){x(f)}finally{u.loadingPosts=!1}};d(),ts(async(f,g)=>{if(p.value=f.params.tab||"posts",f.params.userId!==g.params.userId){if(!xs(f.params.userId))return{name:"NotFoundPage"};o.params.userId=f.params.userId,d()}});const C=async f=>{u.loadingPosts=!0;try{const g=f==="posts"?await M({user:o.params.userId}):await W();u.posts=g.data}catch(g){x(g)}finally{u.loadingPosts=!1}},t=A(!1),P=A({}),I=f=>{P.value=f,t.value=!0};return(f,g)=>(n(),w($s,null,{default:m(()=>[s("div",qe,[a(ke),s("section",null,[a(V),a(cs,{modelValue:p.value,"onUpdate:modelValue":[g[0]||(g[0]=e=>p.value=e),C],"switch-indicator":"","inline-label":"","active-color":"dark","indicator-color":"dark","narrow-indicator":"",class:"q-mb-md text-grey"},{default:m(()=>[a(H,{name:"posts",label:"\u8CBC\u6587",icon:"eva-grid-outline"}),_(v)?(n(),w(H,{key:0,name:"likes",label:"\u6309\u8B9A\u8CBC\u6587",icon:"eva-heart-outline"})):$("",!0)]),_:1},8,["modelValue"]),s("div",$e,[s("ul",Be,[(n(!0),h(b,null,T(_(u).posts,e=>(n(),h("li",{key:e._id,class:"col-4 cursor-pointer"},[a(Qe,{post:e,onShowPost:I},null,8,["post"])]))),128))]),_(u).posts.length===0?(n(),h("div",Se,[p.value==="posts"?(n(),h(b,{key:0},[a(D,{size:"100px",icon:"eva-grid-outline"}),_(v)?(n(),h("p",Fe,"\u5FEB\u4F86\u767C\u5E03\u4F60\u7684\u7B2C\u4E00\u5247\u8CBC\u6587\u5427\uFF01")):(n(),h("p",Ae,"\u8A72\u7528\u6236\u6C92\u6709\u4EFB\u4F55\u8CBC\u6587\u3002"))],64)):p.value==="likes"?(n(),h(b,{key:1},[a(D,{size:"100px",icon:"eva-heart-outline"}),De],64)):$("",!0)])):$("",!0),a(As,{showing:_(u).loadingPosts,label:"Please wait...","label-style":"font-size: 1.1em"},null,8,["showing"])])])]),a(Ss,{modelValue:t.value,"onUpdate:modelValue":g[1]||(g[1]=e=>t.value=e),post:P.value,onAddComment:_(u).addComment,onDeleteComment:_(u).removeComment,onLike:_(u).updateLikes},null,8,["modelValue","post","onAddComment","onDeleteComment","onLike"])]),_:1}))}};export{Re as default};
