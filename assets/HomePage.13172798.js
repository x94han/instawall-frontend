import{a as L,Q as S}from"./QCardSection.b4764d2d.js";import{a3 as H,H as l,a6 as P,K as a,J as e,F as Y,q as $,a as N,r as C,G as j,O as F,N as r,L as s,R as I,a7 as _,aC as b,Q as V,I as d,aB as A,M as D,aQ as M,aR as T,aG as E}from"./index.ef0b161e.js";import{o as f,q as Q,t as O,n as R}from"./PostEditorDialog.161797bd.js";import{Q as B}from"./notifyApiSuccess.91591755.js";import{Q as U}from"./QPage.364c4deb.js";import{n as G}from"./notifyApiError.22ce61ab.js";import{Q as c,a as z,b as J,d as K,_ as W}from"./PostDialog.1ff7ebff.js";import"./QSeparator.f2252361.js";const X={};function Z(q,u){return l(),P(S,{flat:"",bordered:""},{default:a(()=>[e(B,null,{default:a(()=>[e(f,{avatar:""},{default:a(()=>[e(c,{type:"QAvatar",animation:"fade"})]),_:1}),e(f,null,{default:a(()=>[e(Q,null,{default:a(()=>[e(c,{type:"text",animation:"fade"})]),_:1}),e(Q,{caption:""},{default:a(()=>[e(c,{type:"text",animation:"fade"})]),_:1})]),_:1})]),_:1}),e(c,{height:"200px",square:"",animation:"fade"}),e(L,null,{default:a(()=>[e(c,{type:"text",class:"text-subtitle2",animation:"fade"}),e(c,{type:"text",width:"50%",class:"text-subtitle2",animation:"fade"})]),_:1})]),_:1})}var ee=H(X,[["render",Z]]);const te=["src"],ae={key:0,class:"text-bold q-mb-xs"},se={class:"cursor-pointer"},oe={class:"overflow-wrap-break white-space-line q-mb-sm"},ne={class:"cursor-pointer text-body2 text-grey"},le={class:"list-unstyled"},re={class:"text-caption text-grey"},ie={__name:"PostCard",props:{post:{type:Object,required:!0}},emits:["showComments","deleteComment","like"],setup(q,{emit:u}){const t=q,h=Y(),p=$("defaultAvatar"),w=$("tenThousandths"),v=N(()=>t.post.comments?t.post.comments.filter(n=>n.user._id===h.user._id):[]),y=(n,o)=>{u("deleteComment",n,o)},k=N(()=>{var n,o;return(o=(n=t.post.likes)==null?void 0:n.includes(h.user._id))!=null?o:!1}),i=C(!1),g=async()=>{i.value=!0;try{const{data:n}=k.value?await T(t.post._id):await M(t.post._id),{_id:o,likes:x}=n;u("like",o,x)}catch(n){G(n)}finally{i.value=!1}};return(n,o)=>{const x=j("router-link");return l(),P(S,{class:"q-mb-md",flat:"",bordered:""},{default:a(()=>[e(B,null,{default:a(()=>[e(f,{avatar:"",class:"col-auto"},{default:a(()=>[e(x,{to:{name:"PersonalPage",params:{userId:t.post.user._id}}},{default:a(()=>[e(F,{size:"md"},{default:a(()=>{var m;return[r("img",{src:(m=t.post.user.avatar)!=null?m:s(p)},null,8,te)]}),_:1})]),_:1},8,["to"])]),_:1}),e(f,null,{default:a(()=>[e(Q,null,{default:a(()=>[e(x,{to:{name:"PersonalPage",params:{userId:t.post.user._id}},class:"link-text text-bold"},{default:a(()=>[I(_(t.post.user.screenName),1)]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),r("div",null,[t.post.image?(l(),P(O,{key:0,src:t.post.image},null,8,["src"])):b("",!0),e(z,null,{default:a(()=>[e(V,{icon:s(k)?"eva-heart":"eva-heart-outline",onClick:g,loading:i.value,"text-color":s(k)?"red":"",round:"",flat:"","fab-mini":""},null,8,["icon","loading","text-color"]),e(V,{onClick:o[0]||(o[0]=m=>n.$emit("showComments",t.post)),flat:"",round:"","fab-mini":"",icon:"eva-message-circle-outline"})]),_:1}),e(L,{class:"q-pt-none"},{default:a(()=>[t.post.likes.length>0?(l(),d("div",ae,[r("a",se,_(s(w)(t.post.likes.length))+" \u500B\u8B9A",1)])):b("",!0),r("div",oe,_(t.post.content),1),t.post.comments.length>0?(l(),d("div",{key:1,onClick:o[1]||(o[1]=m=>n.$emit("showComments",t.post)),class:"q-mb-sm"},[r("a",ne," \u67E5\u770B\u5168\u90E8 "+_(s(w)(t.post.comments.length))+" \u5247\u7559\u8A00",1)])):b("",!0),r("ul",le,[(l(!0),d(D,null,A(s(v),m=>(l(),d("li",{key:m._id},[e(J,{comment:m,onDelete:y,avatar:!1,createdAt:!1},null,8,["comment"])]))),128))]),r("div",re,_(s(K).formatDate(new Date(t.post.createdAt),"YYYY\u5E74M\u6708D\u65E5")),1)]),_:1})])]),_:1})}}},de={class:"constrain row justify-center q-py-lg"},ue={class:"col"},me={key:0,class:"list-unstyled q-mt-none q-mx-auto q-mr-sm-none",style:{"max-width":"470px"}},ce={key:1,class:"list-unstyled q-mt-none q-mx-auto q-mr-sm-none",style:{"max-width":"470px"}},_e={key:0,class:"text-center"},fe=I(" \u767C\u5E03\u7B2C\u4E00\u5247\u8CBC\u6587\u5427\uFF01 "),pe={class:"col-4 lg-screen-only"},ve=["src"],Qe={__name:"HomePage",setup(q){const u=Y(),t=R(),h=$("defaultAvatar"),p=C(!1);(async()=>{p.value=!0;try{const i=await E();t.posts=i.data}catch(i){G(i)}finally{p.value=!1}})();const v=C(!1),y=C({}),k=i=>{y.value=i,v.value=!0};return(i,g)=>{const n=j("router-link");return l(),P(U,null,{default:a(()=>[r("div",de,[r("div",ue,[p.value?(l(),d("ul",me,[(l(),d(D,null,A(5,o=>r("li",{key:o,class:"q-mb-md"},[e(ee)])),64))])):(l(),d("ul",ce,[s(t).posts.length===0?(l(),d("li",_e,[e(S,{flat:"",bordered:""},{default:a(()=>[e(L,{class:"text-center"},{default:a(()=>[fe]),_:1})]),_:1})])):b("",!0),(l(!0),d(D,null,A(s(t).posts,o=>(l(),d("li",{key:o._id},[e(ie,{post:o,onShowComments:k,onDeleteComment:s(t).removeComment,onLike:s(t).updateLikes},null,8,["post","onDeleteComment","onLike"])]))),128))]))]),r("div",pe,[e(B,{class:"fixed"},{default:a(()=>[e(f,{avatar:""},{default:a(()=>[e(n,{to:{name:"PersonalPage",params:{userId:s(u).user._id}}},{default:a(()=>[e(F,null,{default:a(()=>[r("img",{src:s(u).user.avatar||s(h)},null,8,ve)]),_:1})]),_:1},8,["to"])]),_:1}),e(f,null,{default:a(()=>[e(Q,null,{default:a(()=>[e(n,{to:{name:"PersonalPage",params:{userId:s(u).user._id}},class:"link-text text-bold"},{default:a(()=>[I(_(s(u).user.screenName),1)]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})])]),e(W,{modelValue:v.value,"onUpdate:modelValue":g[0]||(g[0]=o=>v.value=o),post:y.value,onAddComment:s(t).addComment,onDeleteComment:s(t).removeComment,onLike:s(t).updateLikes},null,8,["modelValue","post","onAddComment","onDeleteComment","onLike"])]),_:1})}}};export{Qe as default};
